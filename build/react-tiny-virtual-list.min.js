!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t(e.VirtualList={},e.React,e.PropTypes)}(this,function(e,t,i){"use strict";function o(e,t){function i(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function r(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&(i[o[r]]=e[o[r]]);return i}function n(e,i,o,r){return t.createElement("div",a({ref:i},e),t.createElement("div",{style:o},r))}var s,l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},a=function(){return(a=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};!function(e){e.AUTO="auto",e.START="start",e.CENTER="center",e.END="end"}(s||(s={})),function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(e.ScrollDirection||(e.ScrollDirection={}));var c;!function(e){e.OBSERVED="observed",e.REQUESTED="requested"}(c||(c={}));var f,d,u,p,h,m=(f={},f[e.ScrollDirection.VERTICAL]="scrollTop",f[e.ScrollDirection.HORIZONTAL]="scrollLeft",f),S=(d={},d[e.ScrollDirection.VERTICAL]="height",d[e.ScrollDirection.HORIZONTAL]="width",d),I=(u={},u[e.ScrollDirection.VERTICAL]="top",u[e.ScrollDirection.HORIZONTAL]="left",u),g=(p={},p[e.ScrollDirection.VERTICAL]="marginTop",p[e.ScrollDirection.HORIZONTAL]="marginLeft",p),z=(h={},h[e.ScrollDirection.VERTICAL]="marginBottom",h[e.ScrollDirection.HORIZONTAL]="marginRight",h),y=function(){function e(e){var t=e.itemCount,i=e.itemSizeGetter,o=e.estimatedItemSize;this.itemSizeGetter=i,this.itemCount=t,this.estimatedItemSize=o,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return e.prototype.updateConfig=function(e){var t=e.itemCount,i=e.itemSizeGetter,o=e.estimatedItemSize;null!=t&&(this.itemCount=t),null!=o&&(this.estimatedItemSize=o),null!=i&&(this.itemSizeGetter=i)},e.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},e.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this.itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this.itemCount);if(e>this.lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),i=t.offset+t.size,o=this.lastMeasuredIndex+1;o<=e;o++){var r=this.itemSizeGetter(o);if(null==r||isNaN(r))throw Error("Invalid size returned for index "+o+" of value "+r);this.itemSizeAndPositionData[o]={offset:i,size:r},i+=r}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]},e.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},e.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},e.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,i=void 0===t?s.START:t,o=e.containerSize,r=e.currentOffset,n=e.targetIndex;if(o<=0)return 0;var l,a=this.getSizeAndPositionForIndex(n),c=a.offset,f=c-o+a.size;switch(i){case s.END:l=f;break;case s.CENTER:l=c-(o-a.size)/2;break;case s.START:l=c;break;default:l=Math.max(f,Math.min(c,r))}var d=this.getTotalSize();return Math.max(0,Math.min(d-o,l))},e.prototype.getVisibleRange=function(e){var t=e.containerSize,i=e.offset,o=e.overscanCount;if(0===this.getTotalSize())return{};var r=i+t,n=this.findNearestItem(i);if(void 0===n)throw Error("Invalid offset "+i+" specified");var s=this.getSizeAndPositionForIndex(n);i=s.offset+s.size;for(var l=n;i<r&&l<this.itemCount-1;)l++,i+=this.getSizeAndPositionForIndex(l).size;return o&&(n=Math.max(0,n-o),l=Math.min(l+o,this.itemCount-1)),{start:n,stop:l}},e.prototype.resetItem=function(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)},e.prototype.findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),i=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:i,low:0,offset:e}):this.exponentialSearch({index:i,offset:e})},e.prototype.binarySearch=function(e){for(var t=e.low,i=e.high,o=e.offset,r=0,n=0;t<=i;){if(r=t+Math.floor((i-t)/2),(n=this.getSizeAndPositionForIndex(r).offset)===o)return r;n<o?t=r+1:n>o&&(i=r-1)}return t>0?t-1:0},e.prototype.exponentialSearch=function(e){for(var t=e.index,i=e.offset,o=1;t<this.itemCount&&this.getSizeAndPositionForIndex(t).offset<i;)t+=o,o*=2;return this.binarySearch({high:Math.min(t,this.itemCount-1),low:Math.floor(t/2),offset:i})},e}(),v={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},T={position:"relative",width:"100%",minHeight:"100%"},O={position:"absolute",top:0,left:0,width:"100%"},A=a({},O,{position:"sticky"}),x=function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemSizeGetter=function(t){return function(i){return e.getSize(i,t)}},e.sizeAndPositionManager=new y({itemCount:e.props.itemCount,itemSizeGetter:e.itemSizeGetter(e.props.itemSize),estimatedItemSize:e.getEstimatedItemSize()}),e.state={offset:e.props.scrollOffset||null!=e.props.scrollToIndex&&e.getOffsetForIndex(e.props.scrollToIndex)||0,scrollChangeReason:c.REQUESTED},e.styleCache={},e.getRef=function(t){e.rootNode=t},e.handleScroll=function(t){var i=e.props.onScroll,o=e.getNodeOffset();o<0||e.state.offset===o||t.target!==e.rootNode||(e.setState({offset:o,scrollChangeReason:c.OBSERVED}),"function"==typeof i&&i(o,t))},e}return o(l,t),l.prototype.componentDidMount=function(){var e=this.props,t=e.scrollOffset,i=e.scrollToIndex;this.rootNode.addEventListener("scroll",this.handleScroll,{passive:!0}),null!=t?this.scrollTo(t):null!=i&&this.scrollTo(this.getOffsetForIndex(i))},l.prototype.componentWillReceiveProps=function(e){var t=this.props,i=t.estimatedItemSize,o=t.itemCount,r=t.itemSize,n=t.scrollOffset,s=t.scrollToAlignment,l=t.scrollToIndex,a=e.scrollToIndex!==l||e.scrollToAlignment!==s,f=e.itemCount!==o||e.itemSize!==r||e.estimatedItemSize!==i;e.itemSize!==r&&this.sizeAndPositionManager.updateConfig({itemSizeGetter:this.itemSizeGetter(e.itemSize)}),e.itemCount===o&&e.estimatedItemSize===i||this.sizeAndPositionManager.updateConfig({itemCount:e.itemCount,estimatedItemSize:this.getEstimatedItemSize(e)}),f&&this.recomputeSizes(),e.scrollOffset!==n?this.setState({offset:e.scrollOffset||0,scrollChangeReason:c.REQUESTED}):"number"==typeof e.scrollToIndex&&(a||f)&&this.setState({offset:this.getOffsetForIndex(e.scrollToIndex,e.scrollToAlignment,e.itemCount),scrollChangeReason:c.REQUESTED})},l.prototype.componentDidUpdate=function(e,t){var i=this.state,o=i.offset,r=i.scrollChangeReason;t.offset!==o&&r===c.REQUESTED&&this.scrollTo(o)},l.prototype.componentWillUnmount=function(){this.rootNode.removeEventListener("scroll",this.handleScroll)},l.prototype.scrollTo=function(t){var i=this.props.scrollDirection,o=void 0===i?e.ScrollDirection.VERTICAL:i;this.rootNode[m[o]]=t},l.prototype.getOffsetForIndex=function(t,i,o){void 0===i&&(i=this.props.scrollToAlignment),void 0===o&&(o=this.props.itemCount);var r=this.props.scrollDirection,n=void 0===r?e.ScrollDirection.VERTICAL:r;return(t<0||t>=o)&&(t=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:i,containerSize:this.props[S[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:t})},l.prototype.recomputeSizes=function(e){void 0===e&&(e=0),this.styleCache={},this.sizeAndPositionManager.resetItem(e)},l.prototype.render=function(){var t=this,i=this.props,o=(i.estimatedItemSize,i.height),s=i.overscanCount,l=void 0===s?3:s,c=i.renderItem,f=i.renderWrapper,d=void 0===f?n:f,u=(i.itemCount,i.itemSize,i.onItemsRendered),p=(i.onScroll,i.scrollDirection),h=void 0===p?e.ScrollDirection.VERTICAL:p,m=(i.scrollOffset,i.scrollToIndex,i.scrollToAlignment,i.stickyIndices),I=i.style,g=i.width,z=r(i,["estimatedItemSize","height","overscanCount","renderItem","renderWrapper","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","stickyIndices","style","width"]),y=this.state.offset,O=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[S[h]]||0,offset:y,overscanCount:l}),A=O.start,x=O.stop,C=[],R=a({},v,I,{height:o,width:g}),E=a({},T,(M={},M[S[h]]=this.sizeAndPositionManager.getTotalSize(),M));if(null!=m&&0!==m.length&&(m.forEach(function(e){return C.push(c({index:e,style:t.getStyle(e,!0)}))}),h===e.ScrollDirection.HORIZONTAL&&(E.display="flex")),void 0!==A&&void 0!==x){for(var D=A;D<=x;D++)null!=m&&m.includes(D)||C.push(c({index:D,style:this.getStyle(D,!1)}));"function"==typeof u&&u({startIndex:A,stopIndex:x})}return d(a({},z,{style:R}),this.getRef,E,C);var M},l.prototype.getNodeOffset=function(){var t=this.props.scrollDirection,i=void 0===t?e.ScrollDirection.VERTICAL:t;return this.rootNode[m[i]]},l.prototype.getEstimatedItemSize=function(e){return void 0===e&&(e=this.props),e.estimatedItemSize||"number"==typeof e.itemSize&&e.itemSize||50},l.prototype.getSize=function(e,t){return"function"==typeof t?t(e):Array.isArray(t)?t[e]:t},l.prototype.getStyle=function(t,i){var o=this.styleCache[t];if(o)return o;var r=this.props.scrollDirection,n=void 0===r?e.ScrollDirection.VERTICAL:r,s=this.sizeAndPositionManager.getSizeAndPositionForIndex(t),l=s.size,c=s.offset;return this.styleCache[t]=i?a({},A,(f={},f[S[n]]=l,f[g[n]]=c,f[z[n]]=-(c+l),f.zIndex=1,f)):a({},O,(d={},d[S[n]]=l,d[I[n]]=c,d));var f,d},l.defaultProps={overscanCount:3,scrollDirection:e.ScrollDirection.VERTICAL,width:"100%",renderWrapper:n},l.propTypes={estimatedItemSize:i.number,height:i.oneOfType([i.number,i.string]).isRequired,itemCount:i.number.isRequired,itemSize:i.oneOfType([i.number,i.array,i.func]).isRequired,onScroll:i.func,onItemsRendered:i.func,overscanCount:i.number,renderItem:i.func.isRequired,renderWrapper:i.func,scrollOffset:i.number,scrollToIndex:i.number,scrollToAlignment:i.oneOf([s.AUTO,s.START,s.CENTER,s.END]),scrollDirection:i.oneOf([e.ScrollDirection.HORIZONTAL,e.ScrollDirection.VERTICAL]),stickyIndices:i.arrayOf(i.number),style:i.object,width:i.oneOfType([i.number,i.string])},l}(t.PureComponent);e.default=x,Object.defineProperty(e,"__esModule",{value:!0})});
